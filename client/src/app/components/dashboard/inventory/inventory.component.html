<!-- Inventory -->
<section class="mt-5">

  <!--Grid row-->
  <div class="row">

    <!--Inventory grid column-->
    <div class="col-md-12 mb-4">

      <mdb-card class="cascading-admin-card">

        <!--Card title-->
        <div class="admin-up">
          <div class="admin-title blue-gradient d-sm-flex justify-content-between" style="padding: 1.5rem;">
            <h4 class="my-1 text-white">Inventory</h4>
          </div>
        </div>
        <!--/.Card title-->

        <!--Card content-->
        <mdb-card-body>

          <!-- Actions -->
          <div class="mt-3 d-sm-flex justify-content-between px-3">

            <!-- Group actions -->
            <div>
              <mat-form-field>
                <mat-label>Current group:</mat-label>
                <mat-select [(ngModel)]="selectedGroup" (ngModelChange)="getItems()">
                  <mat-option value="">All items ({{ getGroupSize('') }})</mat-option>
                  <mat-option *ngFor="let group of groups" [value]="group">{{ group }} ({{ getGroupSize(group) }})
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <button mat-button (click)="openCreateGroupDialog()">Add Group</button>
              <button *ngIf="canRemoveGroup()" mat-button (click)="deleteGroup()">Remove group</button>
            </div>

            <!-- Search action -->
            <div>
              <mat-form-field class="k-search">
                <mat-label>Search</mat-label>
                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Ex. apples">
              </mat-form-field>
            </div>

            <!-- Items actions -->
            <div>
              <div *ngIf="!showSelect">
                <button mat-button routerLink="/app/inventory/add">
                  <mdb-icon fas icon="plus"></mdb-icon>
                </button>
                <button mat-button (click)="selectColumnToggle('inc')">
                  <mdb-icon fas icon="minus"></mdb-icon>
                </button>
                <button mat-button (click)="selectColumnToggle('set')">
                  <mdb-icon fas icon="pen"></mdb-icon>
                </button>
              </div>
              <div *ngIf="showSelect">
                <span>{{ option === 'set' ? "You are updating " : "You are removing " }} {{ selection.selected.length }}
                  items</span>
                <button mat-button (click)="
                                  option === 'set' ? openUpdateDialog('Update', 'New values for the updated items'):
                                  openUpdateDialog('Remove', 'Removing the following items')
                                  ">
                  <mdb-icon fas icon="check"></mdb-icon>
                </button>
                <button mat-button (click)="selectColumnToggle()">
                  <mdb-icon fas icon="times"></mdb-icon>
                </button>
              </div>
            </div>
          </div>
          <!-- /Actions -->

          <!-- Data table -->
          <div class="mt-3">
            <div *ngIf="loading" class="loader k-center k-text-center"></div>
            <div *ngIf="isEmpty() && loading===false" class="k-center k-text-center">
              <h1>(╥︣﹏᷅╥)</h1>
              <h2>Inventory is empty</h2>
              <span>Try adding items at the top right now!</span>
            </div>
            <div [hidden]="isEmpty() || loading">
              <div class="k-float-right">
              </div>
              <table class="mat-elevation-z1" mat-table [dataSource]="inventory" matSort>

                <!-- Checkbox Column -->
                <ng-container matColumnDef="select" *ngIf="showSelect">
                  <th mat-header-cell *matHeaderCellDef>
                    <mat-checkbox (change)="$event ? selectMasterToggle() : null"
                      [checked]="selection.hasValue() && isAllSelected()"
                      [indeterminate]="selection.hasValue() && !isAllSelected()">
                    </mat-checkbox>
                  </th>
                  <td mat-cell *matCellDef="let item">
                    <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selectionToggle(item) : null"
                      [checked]="selection.isSelected(item)">
                    </mat-checkbox>
                  </td>
                </ng-container>

                <!-- name Column -->
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
                  <td mat-cell *matCellDef="let item">
                    <div *ngIf="selection.isSelected(item); else viewName">
                      <div *ngIf="option === 'set'; else viewName">
                        <div class="md-form input-group mt-3">
                          <input mdbInput mdbValidate type="text" id="name" class="form-control" [formControl]="f(item._id).name">
                          <mdb-error *ngIf="f(item._id).name.invalid && (f(item._id).name.dirty || f(item._id).name.touched)">
                            <div *ngIf="f(item._id).name.errors.required">Name is required</div>
                            <div *ngIf="f(item._id).name.errors.minlength">Minimum length is 2</div>
                            <div *ngIf="f(item._id).name.errors.maxlength">Maximum length is 30</div>
                            <div *ngIf="f(item._id).name.errors.pattern">Must only be an alphanumeric, space ( ),
                              underscore
                              (_), or dash (-)</div>
                          </mdb-error>
                        </div>
                      </div>
                    </div>
                    <ng-template #viewName><span>{{ item.name }}</span></ng-template>
                  </td>
                </ng-container>

                <!-- quantity Column -->
                <ng-container matColumnDef="quantity">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantity</th>
                  <td mat-cell *matCellDef="let item">
                    <div *ngIf="selection.isSelected(item); else viewQuantity">
                      <div class="md-form input-group mt-3">
                        <input mdbInput mdbValidate type="text" id="quantity" class="form-control" [formControl]="f(item._id).quantity">
                        <div class="input-group-append">
                          <span class="input-group-text md-addon">/ {{ item.quantity }}</span>
                        </div>
                        <mdb-error *ngIf="f(item._id).quantity.invalid && (f(item._id).quantity.dirty || f(item._id).quantity.touched)">
                          <div *ngIf="f(item._id).quantity.errors.required">Quantity is required</div>
                          <div *ngIf="f(item._id).quantity.errors.min">Minimum quantity is 1</div>
                          <div *ngIf="f(item._id).quantity.errors.max">Maximum quantity is
                            {{ f(item._id).quantity.errors.max.max }}</div>
                        </mdb-error>
                      </div>
                    </div>
                    <ng-template #viewQuantity><span matTooltip="quantity">{{ item.quantity }}</span></ng-template>
                  </td>
                </ng-container>

                <!-- group Column -->
                <ng-container matColumnDef="group">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Group</th>
                  <td mat-cell *matCellDef="let item">
                    <div *ngIf="selection.isSelected(item); else viewGroup">
                      <div *ngIf="option === 'set'; else viewGroup">
                        <mat-form-field style="width: 98%">
                          <mat-select [formControl]="f(item._id).group">
                            <mat-option *ngFor="let group of groups" [value]="group">{{ group }}</mat-option>
                          </mat-select>
                          <mat-error *ngIf="f(item._id).group.errors">
                            <div *ngIf="f(item._id).group.errors.required">Group is required</div>
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <ng-template #viewGroup><span matTooltip="Group">{{ item.group }}</span></ng-template>
                  </td>
                </ng-container>

                <!-- addedDate Column -->
                <ng-container matColumnDef="addedDate">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Added</th>
                  <td mat-cell *matCellDef="let item">
                    <div *ngIf="selection.isSelected(item); else viewAddedDate">
                      <div *ngIf="option === 'set'; else viewAddedDate">
                        <mat-form-field style="width: 98%">
                          <input matInput [formControl]="f(item._id).addedDate" [matDatepicker]="picker" />
                          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                          <mat-datepicker #picker></mat-datepicker>
                          <mat-error *ngIf="f(item._id).addedDate.errors">
                            <div *ngIf="f(item._id).addedDate.errors.required">Added date is required</div>
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <ng-template #viewAddedDate><span
                        matTooltip="{{item.addedDate | date}}">{{ item.addedDate | date }}</span>
                    </ng-template>
                  </td>
                </ng-container>

                <!-- expirationDate Column -->
                <ng-container matColumnDef="expirationDate">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Expiration</th>
                  <td mat-cell *matCellDef="let item">

                    <div *ngIf="selection.isSelected(item); else viewExpirationDate">
                      <div *ngIf="option === 'set'; else viewExpirationDate">
                        <mat-form-field style="width: 98%">
                          <input matInput [formControl]="f(item._id).expirationDate" [matDatepicker]="picker2" />
                          <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                          <mat-datepicker #picker2></mat-datepicker>
                          <mat-error *ngIf="f(item._id).expirationDate.errors">
                            <div *ngIf="f(item._id).expirationDate.errors.required">Expiration date is required</div>
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <ng-template #viewExpirationDate>
                      <span
                        matTooltip="{{ item.expirationDate | date }}">{{ item.expirationDate | countdown | expiration }}</span>
                      <span
                        [ngClass]="['label', 'k-float-right', item.expirationDate | countdown | status]">{{ item.expirationDate | countdown | status | titlecase }}</span>
                    </ng-template>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>

              <mat-paginator [pageSizeOptions]="[10, 15, 20]" showFirstLastButtons></mat-paginator>
            </div>
          </div>
          <!-- /Data table -->
        </mdb-card-body>

        <!--/.Card content-->
      </mdb-card>
      <!--/.Card-->

    </div>
    <!--Grid column-->

  </div>
  <!--Grid row-->

</section>